<!DOCTYPE html>
<html>
<head>
  <title>Visualisasi Data Produk Terjual</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    #chart-container {
      width: 60%; /* Lebar kontainer grafik diatur agar lebih kecil */
      height: 400px; /* Tinggi kontainer grafik */
      margin: auto;
    }
    #sales-table {
      width: 60%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    #sales-table th, #sales-table td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    #sales-table th {
      background-color: #f2f2f2;
      text-align: center;
    }
    #sales-table td {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center;">Visualisasi Data Produk Terjual</h1>
  <div id="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <div id="table-container">
    <h2 style="text-align: center;">Data Penjualan Detail</h2>
    <table id="sales-table">
      <thead>
        <tr>
          <th>Nama Toko</th>
          <th>Jenis Prosesor</th>
          <th>Jumlah Terjual</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data akan ditambahkan secara dinamis menggunakan JavaScript -->
      </tbody>
    </table>
  </div>

  <script>
    // Fungsi untuk mengekstrak jumlah terjual dari file JSON
    function getTotalSold(data) {
      let totalSold = 0;
      for (const item of data) {
        if (item.sold && item.sold !== 'N/A') {
          const soldCount = parseInt(item.sold.replace(/\D/g, ''));
          totalSold += isNaN(soldCount) ? 0 : soldCount;
        }
      }
      return totalSold;
    }

    // Fungsi untuk membaca file JSON dan mendapatkan data
    async function getData() {
      const fetchData = async (file) => {
        const response = await fetch(file);
        return await response.json();
      };

      const intelEnterData = await fetchData('../outputScrap/processor/intel_enter.json');
      const amdEnterData = await fetchData('../outputScrap/processor/amd_enter.json');
      const intelExpertData = await fetchData('../outputScrap/processor/intel_expert.json');
      const amdExpertData = await fetchData('../outputScrap/processor/amd_expert.json');
      const intelJayaData = await fetchData('../outputScrap/processor/intel_jaya.json');
      const amdJayaData = await fetchData('../outputScrap/processor/amd_jaya.json');
      const intelITShopData = await fetchData('../outputScrap/processor/intel_itshop.json');
      const amdITShopData = await fetchData('../outputScrap/processor/amd_itshop.json');
      const intelBZonesData = await fetchData('../outputScrap/processor/intel_bzones.json');
      const amdBZonesData = await fetchData('../outputScrap/processor/amd_bzones.json');

      const data = {
        labels: ['Toko Enter', 'Toko Expert', 'Toko Jaya', 'ITShop', 'BZones'],
        datasets: [
          {
            label: 'Intel',
            data: [
              getTotalSold(intelEnterData),
              getTotalSold(intelExpertData),
              getTotalSold(intelJayaData),
              getTotalSold(intelITShopData),
              getTotalSold(intelBZonesData)
            ],
            backgroundColor: 'rgba(54, 162, 235, 0.5)'
          },
          {
            label: 'AMD',
            data: [
              getTotalSold(amdEnterData),
              getTotalSold(amdExpertData),
              getTotalSold(amdJayaData),
              getTotalSold(amdITShopData),
              getTotalSold(amdBZonesData)
            ],
            backgroundColor: 'rgba(255, 99, 132, 0.5)'
          }
        ]
      };

      return data;
    }

    // Membuat grafik bar
    async function createChart() {
      const data = await getData();
      const ctx = document.getElementById('myChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1000  // Menetapkan kelipatan 1000 pada sumbu Y
              }
            }
          }
        }
      });

      // Menambahkan data ke tabel
      const tableBody = document.querySelector('#sales-table tbody');
      data.labels.forEach((label, index) => {
        const rowData = `
          <tr>
            <td>${label}</td>
            <td>Intel</td>
            <td>${data.datasets[0].data[index].toLocaleString()}</td>
          </tr>
          <tr>
            <td>${label}</td>
            <td>AMD</td>
            <td>${data.datasets[1].data[index].toLocaleString()}</td>
          </tr>
        `;
        tableBody.innerHTML += rowData;
      });
    }

    createChart();
  </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <title>Visualisasi Data Produk Terjual</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    #chart-container {
      width: 60%; /* Lebar kontainer grafik diatur agar lebih kecil */
      height: 400px; /* Tinggi kontainer grafik */
      margin: auto;
    }
    #sales-table {
      width: 60%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    #sales-table th, #sales-table td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    #sales-table th {
      background-color: #f2f2f2;
      text-align: center;
    }
    #sales-table td {
      text-align: center;
    }
    #input-container {
      width: 60%;
      margin: 20px auto;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center;">Visualisasi Data Produk Terjual</h1>
  
  <div id="input-container">
    <label><input type="checkbox" value="Toko Enter" checked onclick="updateChart()"> Toko Enter</label>
    <label><input type="checkbox" value="Toko Expert" checked onclick="updateChart()"> Toko Expert</label>
    <label><input type="checkbox" value="Toko Jaya" checked onclick="updateChart()"> Toko Jaya</label>
    <label><input type="checkbox" value="ITShop" checked onclick="updateChart()"> ITShop</label>
    <label><input type="checkbox" value="BZones" checked onclick="updateChart()"> BZones</label>
  </div>

  <div id="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  
  <div id="table-container">
    <h2 style="text-align: center;">Data Penjualan Detail</h2>
    <table id="sales-table">
      <thead>
        <tr>
          <th>Nama Toko</th>
          <th>Jenis Prosesor</th>
          <th>Jumlah Terjual</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data akan ditambahkan secara dinamis menggunakan JavaScript -->
      </tbody>
    </table>
  </div>

  <script>
    // Fungsi untuk mengekstrak jumlah terjual dari file JSON
    function getTotalSold(data) {
      let totalSold = 0;
      for (const item of data) {
        if (item.sold && item.sold !== 'N/A') {
          const soldCount = parseInt(item.sold.replace(/\D/g, ''));
          totalSold += isNaN(soldCount) ? 0 : soldCount;
        }
      }
      return totalSold;
    }

    // Fungsi untuk membaca file JSON dan mendapatkan data
    async function getData() {
      const fetchData = async (file) => {
        const response = await fetch(file);
        return await response.json();
      };

      const intelEnterData = await fetchData('../outputScrap/processor/intel_enter.json');
      const amdEnterData = await fetchData('../outputScrap/processor/amd_enter.json');
      const intelExpertData = await fetchData('../outputScrap/processor/intel_expert.json');
      const amdExpertData = await fetchData('../outputScrap/processor/amd_expert.json');
      const intelJayaData = await fetchData('../outputScrap/processor/intel_jaya.json');
      const amdJayaData = await fetchData('../outputScrap/processor/amd_jaya.json');
      const intelITShopData = await fetchData('../outputScrap/processor/intel_itshop.json');
      const amdITShopData = await fetchData('../outputScrap/processor/amd_itshop.json');
      const intelBZonesData = await fetchData('../outputScrap/processor/intel_bzones.json');
      const amdBZonesData = await fetchData('../outputScrap/processor/amd_bzones.json');

      return {
        'Toko Enter': { intel: getTotalSold(intelEnterData), amd: getTotalSold(amdEnterData) },
        'Toko Expert': { intel: getTotalSold(intelExpertData), amd: getTotalSold(amdExpertData) },
        'Toko Jaya': { intel: getTotalSold(intelJayaData), amd: getTotalSold(amdJayaData) },
        'ITShop': { intel: getTotalSold(intelITShopData), amd: getTotalSold(amdITShopData) },
        'BZones': { intel: getTotalSold(intelBZonesData), amd: getTotalSold(amdBZonesData) }
      };
    }

    // Fungsi untuk membuat grafik bar berdasarkan toko yang dipilih
    async function createChart(data) {
      const ctx = document.getElementById('myChart').getContext('2d');
      if (window.myChart) {
        window.myChart.destroy();
      }
      window.myChart = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1000  // Menetapkan kelipatan 1000 pada sumbu Y
              }
            }
          }
        }
      });
    }

    // Fungsi untuk memperbarui grafik dan tabel berdasarkan toko yang dipilih
    async function updateChart() {
      const data = await getData();
      const selectedStores = Array.from(document.querySelectorAll('#input-container input:checked')).map(input => input.value);

      const labels = [];
      const intelData = [];
      const amdData = [];

      selectedStores.forEach(store => {
        labels.push(store);
        intelData.push(data[store].intel);
        amdData.push(data[store].amd);
      });

      const chartData = {
        labels: labels,
        datasets: [
          {
            label: 'Intel',
            data: intelData,
            backgroundColor: 'rgba(54, 162, 235, 0.5)'
          },
          {
            label: 'AMD',
            data: amdData,
            backgroundColor: 'rgba(255, 99, 132, 0.5)'
          }
        ]
      };

      createChart(chartData);

      // Memperbarui data pada tabel
      const tableBody = document.querySelector('#sales-table tbody');
      tableBody.innerHTML = ''; // Kosongkan isi tabel
      selectedStores.forEach((store, index) => {
        const rowData = `
          <tr>
            <td>${store}</td>
            <td>Intel</td>
            <td>${chartData.datasets[0].data[index].toLocaleString()}</td>
          </tr>
          <tr>
            <td>${store}</td>
            <td>AMD</td>
            <td>${chartData.datasets[1].data[index].toLocaleString()}</td>
          </tr>
        `;
        tableBody.innerHTML += rowData;
      });
    }

    // Inisialisasi grafik dengan semua toko terpilih
    updateChart();
  </script>
</body>
</html>
